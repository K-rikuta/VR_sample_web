<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>利用前アンケート - VR貸し出しシステム</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
  <style>
    body {
      background: #e8f5e9;
    }
    .question-card {
      background: #f1f8e9;
      border: 2px solid #66bb6a;
      border-radius: 1rem;
      box-shadow: 0 0 12px 2px #ccff90;
    }
    .question-title {
      color: #388e3c;
      font-weight: bold;
      font-size: 1.5rem;
    }
    .btn-success, .btn-success:focus {
      background-color: #66bb6a !important;
      border-color: #66bb6a !important;
      color: #fff !important;
    }
    .btn-success:hover {
      background-color: #388e3c !important;
      border-color: #388e3c !important;
      color: #fff !important;
      box-shadow: 0 0 12px 2px #ccff90;
    }
    .form-check-input:checked {
      background-color: #66bb6a;
      border-color: #388e3c;
    }
  </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container-fluid">
    <a class="navbar-brand text-warning fw-bold" href="index.html">VR貸し出しシステム</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
      aria-controls="navbarNav" aria-expanded="false" aria-label="ナビゲーションの切り替え">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item">
          <a class="nav-link" href="register.html">新規登録</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="login.html">ログイン</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="notice.html">注意事項</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="terms.html">利用規約</a>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            メニュー
          </a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="profile.html">プロフィール</a></li>
            <li><a class="dropdown-item" href="settings.html">設定</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="logout.html">ログアウト</a></li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="container mt-5 mb-4 px-3 px-md-5" style="max-width: 700px;">
  <div class="question-card p-4">
    <form id="questionForm">
      <!-- 1問目 -->
      <div class="mb-4">
        <div class="question-title mb-2">1. これまでにこのシステムを利用したことがありますか。</div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="usedBefore" id="usedYes" value="はい" required>
          <label class="form-check-label" for="usedYes">はい</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="usedBefore" id="usedNo" value="いいえ">
          <label class="form-check-label" for="usedNo">いいえ</label>
        </div>
      </div>
      <!-- 2問目: 利用規約 -->
      <div class="mb-4">
        <div class="question-title mb-2">2. 利用規約</div>
        <div class="accordion mb-2" id="termsAccordion">
          <div class="accordion-item">
            <h2 class="accordion-header" id="headingTerms">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTerms" aria-expanded="false" aria-controls="collapseTerms" style="background:#e8f5e9; color:#388e3c; font-size:1rem;">
                利用規約を表示
              </button>
            </h2>
            <div id="collapseTerms" class="accordion-collapse collapse" aria-labelledby="headingTerms" data-bs-parent="#termsAccordion">
              <div class="accordion-body" style="background:#f1f8e9; color:#388e3c; font-size:0.95rem;">
                この利用規約は、VR貸し出しシステムの使用に関する条件を定めたものです。<br>
                <b>1. 利用資格</b><br>
                本システムを利用するには、麗澤大学生である必要があります。<br>
                <b>2. 利用目的</b><br>
                本システムは、VR機器の貸し出しを目的としています。<br>
                <b>3. 責任の制限</b><br>
                本システムの利用により生じた損害について、私は一切の責任を負いません。<br>
                <b>4. 規約の変更</b><br>
                私は、必要に応じて本規約を変更することがあります。<br>
                <b>5. お問い合わせ</b><br>
                ご不明な点がございましたら、サポート（a240369r@reitaku.jp）までお問い合わせください。
              </div>
            </div>
          </div>
        </div>
        <div class="question-title mb-2 mt-3">利用規約に同意しますか。</div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="agree" id="agreeYes" value="はい" required>
          <label class="form-check-label" for="agreeYes">はい</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="agree" id="agreeNo" value="いいえ">
          <label class="form-check-label" for="agreeNo">いいえ</label>
        </div>
      </div>
      <!-- 3問目: 学籍番号・職員番号 -->
      <div class="mb-4">
        <div class="question-title mb-2">3. 学籍番号・職員番号を入力してください。</div>
        <input type="text" class="form-control" name="studentId" id="studentId" required placeholder="例: 12345678">
      </div>
      <!-- 4問目: 名前 -->
      <div class="mb-4">
        <div class="question-title mb-2">4. 名前を入力してください。</div>
        <input type="text" class="form-control" name="name" id="name" required placeholder="例: 山田 太郎">
      </div>
      <!-- 5問目: 学部・専攻 -->
      <div class="mb-4">
        <div class="question-title mb-2">5. 学部・専攻を入力してください。</div>
        <input type="text" class="form-control" name="major" id="major" required placeholder="例: 経済学部 経済学科">
      </div>
      <!-- 6問目: 麗澤大学のメールアドレス -->
      <div class="mb-4">
        <div class="question-title mb-2">6. 麗澤大学のメールアドレスを入力してください。</div>
        <input type="email" class="form-control" name="email" id="email" required placeholder="例: xxxxxxxx@reitaku.jp">
        <div id="emailHelp" class="form-text text-danger d-none"></div>
      </div>
      <!-- 7問目: 借用開始日 -->
      <div class="mb-4">
        <div class="question-title mb-2">7. 借用開始日を選択してください。</div>
        <input type="date" class="form-control" name="startDate" id="startDate" required>
        <div class="form-text text-success mt-2">※返却日は借用開始日から2週間後です。</div>
      </div>
      <div class="text-center">
        <button type="submit" class="btn btn-success start-button" style="width:200px;">送信</button>
      </div>
    </form>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
document.getElementsByName('usedBefore').forEach(function(radio) {
  radio.addEventListener('change', function() {
    // 1問目のイベントは不要になったので空にしておく
  });
});
document.getElementById('questionForm').addEventListener('submit', function(e) {
  // 利用規約同意チェック
  if(document.querySelector('input[name="agree"]:checked')?.value !== "はい") {
    alert("利用規約に同意しないと進めません。");
    e.preventDefault();
    return;
  }
  // 麗澤大学メールアドレスチェック
  const email = document.getElementById('email').value;
  const emailHelp = document.getElementById('emailHelp');
  if (!/@reitaku\.jp$/.test(email)) {
    emailHelp.classList.remove('d-none');
    emailHelp.textContent = "メールアドレスは@reitaku.jpで終わる必要があります。";
    e.preventDefault();
    return;
  } else {
    emailHelp.classList.add('d-none');
  }
  // 送信時に予約完了ページへ遷移し、必要な情報をクエリパラメータで渡す
  e.preventDefault();
  // VR番号をランダムで割り当て（例: 1〜30番）
  const vrNumber = Math.floor(Math.random() * 30) + 1;
  // 借用開始日取得
  const startDate = document.getElementById('startDate').value;
  // 返却日計算（開始日＋14日）
  const start = new Date(startDate);
  start.setDate(start.getDate() + 14);
  const returnY = start.getFullYear();
  const returnM = String(start.getMonth() + 1).padStart(2, '0');
  const returnD = String(start.getDate()).padStart(2, '0');
  const returnDate = `${returnY}-${returnM}-${returnD}`;
  // 遷移
  window.location.href = `reserve-complete.html?vr=${vrNumber}&date=${returnDate}`;
});
</script>
</body>
</html>
